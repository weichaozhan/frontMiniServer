{"remainingRequest":"D:\\testspace\\frontMiniServer\\react\\mainApp\\node_modules\\_babel-loader@7.1.5@babel-loader\\lib\\index.js?cacheDirectory!D:\\testspace\\frontMiniServer\\react\\mainApp\\node_modules\\_eslint-loader@2.1.1@eslint-loader\\index.js!D:\\testspace\\frontMiniServer\\react\\mainApp\\src\\router\\Index.jsx","dependencies":[{"path":"D:\\testspace\\frontMiniServer\\react\\mainApp\\src\\router\\Index.jsx","mtime":1547101837762},{"path":"D:\\testspace\\frontMiniServer\\react\\mainApp\\.babelrc","mtime":1546939123052},{"path":"D:\\testspace\\frontMiniServer\\react\\mainApp\\node_modules\\_cache-loader@2.0.1@cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\testspace\\frontMiniServer\\react\\mainApp\\node_modules\\_babel-loader@7.1.5@babel-loader\\lib\\index.js","mtime":1530808242000},{"path":"D:\\testspace\\frontMiniServer\\react\\mainApp\\node_modules\\_eslint-loader@2.1.1@eslint-loader\\index.js","mtime":499162500000}],"contextDependencies":[],"result":["'use strict';\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nvar _react = require('react');\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactRouterDom = require('react-router-dom');\n\nvar _suspenseComponent = require('../tools/suspenseComponent');\n\nvar _suspenseComponent2 = _interopRequireDefault(_suspenseComponent);\n\nvar _routes = require('@/router/routes.js');\n\nvar _routes2 = _interopRequireDefault(_routes);\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nfunction _possibleConstructorReturn(self, call) { if (!self) { throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\"); } return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self; }\n\nfunction _inherits(subClass, superClass) { if (typeof superClass !== \"function\" && superClass !== null) { throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }\n\nvar Router = function (_React$Component) {\n  _inherits(Router, _React$Component);\n\n  function Router() {\n    _classCallCheck(this, Router);\n\n    var _this = _possibleConstructorReturn(this, (Router.__proto__ || Object.getPrototypeOf(Router)).call(this));\n\n    _this.state = {\n      routes: [],\n      modulesLoaded: [],\n      isLoading: false\n    };\n    return _this;\n  }\n\n  _createClass(Router, [{\n    key: 'componentWillMount',\n    value: function componentWillMount() {\n      this.load();\n      window.appData = window.appData ? Object.assign(window.appData, { routes: _routes2.default }) : {\n        routes: _routes2.default\n      };\n      this.setState({\n        routes: window.appData.routes\n      });\n    }\n  }, {\n    key: 'componentWillReceiveProps',\n    value: function componentWillReceiveProps() {\n      this.load();\n    }\n\n    /**\r\n     * @description 下载模块代码\r\n     */\n\n  }, {\n    key: 'load',\n    value: function load() {\n      var _this2 = this;\n\n      if (!window.appData || !window.appData.modules) return;\n\n      var appModules = window.appData.modules;\n      var moduleKeys = Object.keys(appModules);\n      var module = location.pathname.split('/')[1];\n\n      moduleKeys.some(function (item) {\n        var modulesLoaded = _this2.state.modulesLoaded;\n\n        var regexp = new RegExp('^' + item);\n        var isMatch = regexp.test(module);\n\n        // 路由开头是否匹配某个模块\n        if (isMatch) {\n          // 模块是否已经下载\n          if (modulesLoaded.indexOf(item) < 0) {\n            _this2.setState({ isLoading: true });\n            var pl = appModules[item].map(function (item) {\n              return new Promise(function (resolve, reject) {\n                var node = document.createElement('script');\n\n                node.setAttribute('src', item);\n                document.body.appendChild(node);\n\n                node.onload = function () {\n                  resolve();\n                };\n              });\n            });\n\n            Promise.all(pl).then(function () {\n              modulesLoaded.push(item);\n\n              _this2.setState({\n                modulesLoaded: modulesLoaded,\n                routes: window.appData.routes,\n                isLoading: false\n              });\n            });\n          }\n        }\n\n        return isMatch;\n      });\n    }\n  }, {\n    key: 'render',\n    value: function render() {\n      var isLoading = this.state.isLoading;\n\n      return _react2.default.createElement(\n        _reactRouterDom.Switch,\n        null,\n        _react2.default.createElement(_reactRouterDom.Route, { path: '/', exact: true, component: (0, _suspenseComponent2.default)((0, _react.lazy)(function () {\n            return import( /* webpackPrefetch: true */'../components/test/Test.jsx');\n          })) }),\n        this.state.routes.map(function (item) {\n          return _react2.default.createElement(_reactRouterDom.Route, { path: item.path, component: item.component, key: item.path });\n        }),\n        isLoading ? _react2.default.createElement(_reactRouterDom.Route, { component: (0, _suspenseComponent2.default)((0, _react.lazy)(function () {\n            return import( /* webpackPrefetch: true */'../components/Loading.jsx');\n          })) }) : _react2.default.createElement(_reactRouterDom.Route, { component: (0, _suspenseComponent2.default)((0, _react.lazy)(function () {\n            return import( /* webpackPrefetch: true */'../components/NoMatch.jsx');\n          })) })\n      );\n    }\n  }]);\n\n  return Router;\n}(_react2.default.Component);\n\nexports.default = Router;",{"version":3,"sources":["src\\router\\Index.jsx"],"names":["Router","state","routes","modulesLoaded","isLoading","load","window","appData","Object","assign","setState","modules","appModules","moduleKeys","keys","module","location","pathname","split","some","regexp","RegExp","item","isMatch","test","indexOf","pl","map","Promise","resolve","reject","node","document","createElement","setAttribute","body","appendChild","onload","all","then","push","path","component","React","Component"],"mappings":"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","file":"Index.jsx","sourceRoot":"D:/testspace/frontMiniServer/react/mainApp","sourcesContent":["import React from 'react';\r\nimport { Switch, Route } from 'react-router-dom';\r\nimport {lazy} from 'react';\r\n\r\nimport suspenseComponent from '../tools/suspenseComponent';\r\nimport routes from '@/router/routes.js';\r\n\r\nclass Router extends React.Component {\r\n  constructor() {\r\n    super();\r\n    this.state = {\r\n      routes: [],\r\n      modulesLoaded: [],\r\n      isLoading: false,\r\n    };\r\n  }\r\n\r\n  componentWillMount() {\r\n    this.load();\r\n    window.appData = window.appData ? Object.assign(window.appData, {routes}) : {\r\n      routes,\r\n    };\r\n    this.setState({\r\n      routes: window.appData.routes,\r\n    });\r\n  }\r\n\r\n  componentWillReceiveProps() {\r\n    this.load();\r\n  }\r\n\r\n  /**\r\n   * @description 下载模块代码\r\n   */\r\n  load() {\r\n    if (!window.appData || !window.appData.modules) return;\r\n\r\n    const appModules = window.appData.modules;\r\n    const moduleKeys = Object.keys(appModules);\r\n    const module = location.pathname.split('/')[1];\r\n    \r\n    moduleKeys.some(item => {\r\n      const { modulesLoaded } = this.state;\r\n      const regexp = new RegExp(`^${item}`);\r\n      const isMatch = regexp.test(module);\r\n      \r\n      // 路由开头是否匹配某个模块\r\n      if (isMatch) {\r\n        // 模块是否已经下载\r\n        if (modulesLoaded.indexOf(item) < 0) {\r\n          this.setState({isLoading: true});\r\n          const pl = appModules[item].map(item => {\r\n            return new Promise((resolve, reject) => {\r\n              const node = document.createElement('script');\r\n    \r\n              node.setAttribute('src', item);\r\n              document.body.appendChild(node);\r\n    \r\n              node.onload = () => {\r\n                resolve();\r\n              };\r\n            });\r\n          });\r\n\r\n          Promise.all(pl)\r\n            .then(() => {\r\n              modulesLoaded.push(item);\r\n                \r\n              this.setState({\r\n                modulesLoaded: modulesLoaded,\r\n                routes: window.appData.routes,\r\n                isLoading: false,\r\n              });\r\n            });\r\n        }\r\n      }\r\n\r\n      return isMatch;\r\n    });\r\n  }\r\n\r\n  render() {\r\n    const isLoading = this.state.isLoading;\r\n  \r\n    return (\r\n      <Switch>\r\n        <Route path=\"/\" exact component={suspenseComponent(lazy(() => import(/* webpackPrefetch: true */'../components/test/Test.jsx')))} />\r\n        {\r\n          this.state.routes.map(item => {\r\n            return (\r\n              <Route path={item.path} component={item.component} key={item.path} />\r\n            );\r\n          })\r\n        }\r\n        {\r\n          isLoading ?\r\n            <Route component={suspenseComponent(lazy(() => import(/* webpackPrefetch: true */'../components/Loading.jsx')))} />\r\n            :\r\n            <Route component={suspenseComponent(lazy(() => import(/* webpackPrefetch: true */'../components/NoMatch.jsx')))} />\r\n        }\r\n      </Switch>\r\n    );\r\n  }\r\n} \r\n\r\nexport default Router;"]}]}